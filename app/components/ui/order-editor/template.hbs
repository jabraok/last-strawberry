{{#if model.hasXeroId}}
  <div class="row baseline syncedMessage">
    <span class="syncedTitle">This order has been synced to Xero: </span>
    <a href={{concat "https://go.xero.com/AccountsReceivable/View.aspx?InvoiceID=" model.xeroId}} target="_blank">View in xero</a>
  </div>
{{/if}}

<section class="contentContainer">
  <section class="row y-center">
    <figure class="companyLogo">
      <img src="/assets/images/company_logo.png">
    </figure>
    <div class="col companyAddress">
      {{#link-to (if model.location.company.isCustomer "customers.show" "vendors.show") model.location.company class="company"}}
        {{model.location.company.name}}
      {{/link-to}}

      {{#link-to (if model.location.company.isCustomer "customers.show.location" "vendors.show.location") model.location.company model.location class="locationInfo"}}
        <span class="uppercase">{{model.location.code}}</span> - {{model.location.name}}
      {{/link-to}}
    </div>
  </section>

  <section>
    <div class="row y-center margin-top-sm deliveryDateContainer">
      <i class="material-icons">date_range</i>
      {{pikaday-input
        value=model.deliveryDate
        format="ddd MM-DD-YYYY"
        onSelected=updateDeliveryDate
        class="deliveryDate"}}
    </div>
  </section>

  <section class="orderItems margin-top-sm">
    <div class="row rowTable orderInfo x-space-between">
      <span class="title">
        {{if isSalesOrder "Invoice" "Purchase Order"}}: <span class="uppercase">{{model.orderNumber}}</span>
      </span>

      {{#ui/popup-menu icon="settings" class="toolbar"}}
        {{ui/icon-button
            type=(if model.isPublished "done_all" "publish")
            class="state"
            flat=true
            color=(if model.isPublished colors.DARK_GREEN colors.HOT_PINK)
            size=1.2
            action=toggleOrderState}}

        {{ui/icon-button
            type="send"
            class="send"
            flat=true
            color=colors.DARK_GREY
            size=1.2
            action=emailOrder
            disabled=(or (not model.isValid) (not model.notifiable))}}

        {{ui/icon-button
            type="local_printshop"
            class="print"
            flat=true
            color=colors.DARK_GREY
            size=1.2
            disabled=(or (not model.isValid) (not model.notifiable))
            action=(action "printOrder")}}

        {{ui/icon-button
            type="close"
            class="delete"
            flat=true
            color=colors.DARK_GREY
            size=1.2
            click=deleteOrder}}
      {{/ui/popup-menu}}
    </div>

    {{#if (or hasUnusedItems isPurchaseOrder)}}
      <div class="rowTable addOrderItemContainer">
        {{#power-select
            placeholder="Add item"
            searchField="name"
            noMatchesMessage=noMatchesMessage
            onkeydown=(action "onItemSearchKeyDown")
            oninput=(action "stashItemSearch")
            selected=customAddItemResult
            options=items
            onchange=(action "createOrderItem")
            as |item|}}
              {{item.name}}
        {{/power-select}}
      </div>
    {{/if}}

    {{#each validOrderItems as |orderItem i|}}
      {{ui/order-editor/order-item-editor
          index=i
          model=orderItem
          update=updateOrderItem
          onOrderItemChange=onOrderItemChange
          save=saveOrderItem
          delete=deleteOrderItem}}
    {{/each}}
  </section>
</section>
{{#if model.notifications.length}}
  {{ui/order-editor/notifications
      notifications=model.notifications}}
{{/if}}

{{#if showCreateItemModal}}
  {{#tether-dialog}}
    {{modals/new-item
        changeset=(changeset stashedItemData validators)
        cancel=(action "cancelCreateNewItem")
        submit=(action "requestCreateNewItem")}}
  {{/tether-dialog}}
{{/if}}
